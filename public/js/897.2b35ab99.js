"use strict";(self["webpackChunkshanotes_ui"]=self["webpackChunkshanotes_ui"]||[]).push([[897],{2897:function(e,t,l){l.r(t),l.d(t,{default:function(){return B}});var a=l(3396);const i={id:"main"};function o(e,t,l,o,n,d){const r=(0,a.up)("PathTree"),s=(0,a.up)("mavon-editor"),c=(0,a.Q2)("loading");return(0,a.wg)(),(0,a.iD)("div",i,[(0,a.Wm)(r,{onClick_path:d.handleClickPath},null,8,["onClick_path"]),n.cur_path&&1!=n.cur_path.link_type?(0,a.wy)(((0,a.wg)(),(0,a.j4)(s,{key:0,id:"md-editor",modelValue:n.markdown_content,"onUpdate:modelValue":t[0]||(t[0]=e=>n.markdown_content=e),onSave:d.saveFile,defaultOpen:"preview",subfield:!1,toolbars:n.markdown_options,navigation:!0},null,8,["modelValue","onSave","toolbars"])),[[c,n.loading]]):(0,a.kq)("",!0)])}function n(e,t,l,i,o,n){const d=(0,a.up)("mavon-editor");return(0,a.wg)(),(0,a.j4)(d,{id:"md-editor",modelValue:o.markdown_content,"onUpdate:modelValue":t[0]||(t[0]=e=>o.markdown_content=e),defaultOpen:"preview",subfield:!1,toolbars:o.markdown_options,navigation:!0},null,8,["modelValue","toolbars"])}var d={data(){return{markdown_options:{navigation:!0,undo:!0,redo:!0,trash:!0,save:!0,subfield:!0,preview:!0},markdown_content:"## hello world\n"}}},r=l(89);const s=(0,r.Z)(d,[["render",n],["__scopeId","data-v-a9d14518"]]);var c=s,_=l(7139);const u=e=>((0,a.dD)("data-v-3abf8188"),e=e(),(0,a.Cn)(),e),h={class:"main"},f={class:"operator-bar"},p=(0,a.Uk)("文件夹"),m=(0,a.Uk)("文件"),w={class:"dialog-footer"},k=(0,a.Uk)("取消"),g=(0,a.Uk)("确认"),v={style:{"margin-bottom":"40px","font-size":"30px",color:"red"}},y=u((()=>(0,a._)("br",null,null,-1))),b={class:"dialog-footer"},W=(0,a.Uk)("取消"),C=(0,a.Uk)("确认");function V(e,t,l,i,o,n){const d=(0,a.up)("ArrowLeft"),r=(0,a.up)("el-icon"),s=(0,a.up)("el-button"),c=(0,a.up)("FolderOpened"),u=(0,a.up)("FolderAdd"),V=(0,a.up)("Delete"),U=(0,a.up)("el-button-group"),x=(0,a.up)("el-tree"),D=(0,a.up)("el-card"),F=(0,a.up)("el-radio"),N=(0,a.up)("el-radio-group"),M=(0,a.up)("el-form-item"),L=(0,a.up)("el-input"),O=(0,a.up)("el-form"),P=(0,a.up)("el-dialog"),z=(0,a.Q2)("loading");return(0,a.wg)(),(0,a.iD)("div",h,[(0,a.Wm)(D,{id:"card"},{header:(0,a.w5)((()=>[(0,a._)("div",f,[(0,a.Wm)(s,{text:"",onClick:n.handleFolderBack},{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d)])),_:1})])),_:1},8,["onClick"]),(0,a.Wm)(U,null,{default:(0,a.w5)((()=>[(0,a.Wm)(s,{text:"",onClick:n.open_folder},{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c)])),_:1})])),_:1},8,["onClick"]),(0,a.Wm)(s,{text:"",onClick:t[0]||(t[0]=e=>o.dialog_vis=!0)},{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a.Wm)(u)])),_:1})])),_:1}),(0,a.Wm)(s,{type:"danger",onClick:n.del_link},{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a.Wm)(V)])),_:1})])),_:1},8,["onClick"])])),_:1})])])),default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(x,{"highlight-current":"",data:o.folder,onNodeClick:n.handleNodeClick,props:{class:n.customNodeClass}},null,8,["data","onNodeClick","props"]),[[z,o.loading]])])),_:1}),(0,a.Wm)(P,{modelValue:o.dialog_vis,"onUpdate:modelValue":t[4]||(t[4]=e=>o.dialog_vis=e),title:"创建新路径","before-close":n.handleDiaClose},{footer:(0,a.w5)((()=>[(0,a._)("span",w,[(0,a.Wm)(s,{onClick:t[3]||(t[3]=e=>o.dialog_vis=!1)},{default:(0,a.w5)((()=>[k])),_:1}),(0,a.Wm)(s,{type:"primary",onClick:n.createLink},{default:(0,a.w5)((()=>[g])),_:1},8,["onClick"])])])),default:(0,a.w5)((()=>[(0,a.Wm)(O,{"label-width":"120px"},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{label:"目录类型"},{default:(0,a.w5)((()=>[(0,a.Wm)(N,{modelValue:o.create_info.type,"onUpdate:modelValue":t[1]||(t[1]=e=>o.create_info.type=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(F,{label:"folder"},{default:(0,a.w5)((()=>[p])),_:1}),(0,a.Wm)(F,{label:"file"},{default:(0,a.w5)((()=>[m])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(M,{label:"标题"},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{modelValue:o.create_info.title,"onUpdate:modelValue":t[2]||(t[2]=e=>o.create_info.title=e),style:{width:"200px"},id:"path-name-input"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","before-close"]),(0,a.Wm)(P,{modelValue:o.del_dia_vis,"onUpdate:modelValue":t[6]||(t[6]=e=>o.del_dia_vis=e),title:"删除确认"},{default:(0,a.w5)((()=>[(0,a._)("span",null,[(0,a._)("p",v,[(0,a.Uk)(" 你确定要删除"+(0,_.zw)(o.selected_folder.title)+"吗？删除操作不可撤销",1),y])]),(0,a._)("span",b,[(0,a.Wm)(s,{onClick:t[5]||(t[5]=e=>o.dialog_vis=!1)},{default:(0,a.w5)((()=>[W])),_:1}),(0,a.Wm)(s,{type:"primary",onClick:n.confirmDeleteLink},{default:(0,a.w5)((()=>[C])),_:1},8,["onClick"])])])),_:1},8,["modelValue"])])}var U=l(5937);async function x(){return await(0,U.gc)("/notes/root")}async function D(e,t){return await(0,U.Mx)("/notes/create_folder",{parent:e,title:t})}async function F(e,t){return await(0,U.Mx)("/notes/create_note",{parent:e,title:t})}async function N(e){return await(0,U.Mx)("/notes/del_link",{path_id:e})}async function M(e){return await(0,U.gc)("/notes/read_link",{path_id:e})}async function L(e,t){return await(0,U.Mx)("/notes/update_link",{path_id:e,content:t})}async function O(e){let t=[],l=await(0,U.gc)("/notes/read_link",{path_id:e});if(200!=l.meta.status)return[];let a=l.content,i=JSON.parse(a.content),o=await(0,U.gc)("/notes/read_child",{path_id:e});if(200!=o.meta.status||!o.value)return[];let n=new Map;o=o.value;for(let d of o)n.set(d.id,d);for(let d of i)n.has(d)&&t.push(n.get(d));return t}var P=l(2807);const z=1;var I={async mounted(){this.froot=this.folder[0],this.selected_folder=this.froot,await this.reload_root()},data(){return{create_info:{title:"",type:""},selected_fid:0,selected_folder:null,loading:!1,dialog_vis:!1,del_dia_vis:!1,is_empty_folder:!1,froot:null,folder:[{label:"根目录",path_id:0,link_type:1,depth:0,children:[],parent:0}]}},methods:{customNodeClass(e,t){let l=t.data;return 1==l.link_type?"is-folder":null},async reload_root(e=0){let t;if(0==e)this.froot.parent=0,this.froot.path_id=0,this.froot.label="根目录",this.froot.depth=0,this.froot.children=[],this.loading=!0,t=await x(),this.loading=!1,this.is_empty_folder=200!=t.meta.status,this.is_empty_folder||(this.froot.children=await this.process_folder(t.value,1));else{let l=await M(e);if(200!=l.meta.status)return alert(l.meta.message);l=l.content,console.log(l),this.froot.path_id=l.id,this.froot.label=l.title,this.froot.parent=l.parent,this.froot.depth=0,this.froot.children=[],this.loading=!0,t=await O(e),this.loading=!1,this.is_empty_folder=null==t,this.is_empty_folder||(this.froot.children=await this.process_folder(t,this.froot.path_id,1))}},async process_folder(e,t,l=1){let a=[];for(let i of e){let e={label:i.title,path_id:i.id,link_type:i.link_type,children:null,parent:t};if(l<this.froot.depth+2&&i.link_type==z){let t=await O(i.id);null!=t&&(e.children=await this.process_folder(t,i.id,l+1))}void 0!=i.children&&null!=i.children&&(e.children=i.children),a.push(e)}return a},handleDiaClose(){this.dialog_vis=!1},async handleFolderBack(){0!=this.froot.path_id&&await this.reload_root(this.froot.parent)},async createLink(){if(this.create_info.title.length<1)return alert("标题必须长度必须大于1");if("folder"==this.create_info.type){let e=await D(this.selected_fid,this.create_info.title);if(200!=e.meta.status)return alert("创建失败");e=e.id;let t={label:this.create_info.title,path_id:e,link_type:1,children:[]};this.selected_folder.children.push(t)}else if("file"==this.create_info.type){let e=await F(this.selected_fid,this.create_info.title);if(200!=e.meta.status)return alert("创建失败");e=e.id;let t={label:this.create_info.title,path_id:e,link_type:2,children:[]};this.selected_folder.children.push(t)}this.dialog_vis=!1},del_link(){this.del_dia_vis=!0},async open_folder(){this.selected_folder.link_type!=z?(0,P.z8)({message:"请打开一个文件夹",type:"error"}):await this.reload_root(this.selected_fid)},async confirmDeleteLink(){await N(this.selected_fid),this.del_dia_vis=!1;let e=t=>{if(t.link_type==z&&t.children){t.children=t.children.filter((e=>e.path_id!=this.selected_fid));for(let l of t.children)e(l)}};e(this.froot)},handleNodeClick(e){this.selected_fid=e.path_id,this.selected_folder=e,this.$emit("click_path",this.selected_folder),e.link_type}}};const S=(0,r.Z)(I,[["render",V],["__scopeId","data-v-3abf8188"]]);var Z=S,j={components:{PathTree:Z,MarkdownViewer:c},data(){return{markdown_options:{navigation:!0,undo:!0,redo:!0,trash:!0,save:!0,subfield:!0,preview:!0},markdown_content:"",cur_path:"",raw_content:"",loading:!1}},computed:{updated(){return this.raw_content!=this.markdown_content}},methods:{async saveFile(){this.loading=!0;let e=this.cur_path.path_id,t=await L(e,this.markdown_content);return this.loading=!1,200!=t.meta.status?alert("保存失败"):(this.raw_content=this.markdown_content,alert("保存成功"))},async handleClickPath(e){if(!e||0==e.path_id||1==e.link_type)return;this.updated&&await this.saveFile(),this.cur_path=e,console.log(e),this.loading=!0;let t=await M(e.path_id);if(this.loading=!1,200!=t.meta.status)return alert("请求数据失败");t=t.content,this.markdown_content=null==t.content?"":t.content,this.raw_content=this.markdown_content}}};const A=(0,r.Z)(j,[["render",o],["__scopeId","data-v-698423d1"]]);var B=A}}]);
//# sourceMappingURL=897.2b35ab99.js.map